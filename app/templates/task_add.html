{% extends 'common/layout.html' %}

{% block title %} 任务列表 {% endblock %}
{% block body %}

<div class="content-wrap">
	<div class="panel panel-primary">
	    <div class="panel-heading" style="padding: 14px">
	        <h3 class="panel-title">任务添加</h3>
	    </div>
	    <div class="panel-body">
	        <form class="form-horizontal">
				<div class="form-group">
				    <label class="col-sm-2 control-label">任务名称</label>
				    <div class="col-sm-10">
				    	<input name="task_name" type="text" class="form-control" placeholder="任务名称">
				    </div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">搜索用户名</label>
					<div class="col-sm-10">
						<input name="search_name" type="text" class="form-control" placeholder="用户名称">
					</div>
				</div>
				<div class="form-group">
					<label class="col-sm-2 control-label">搜索内容</label>
					<div class="col-sm-10">
						<div class="radio">
							<input type="checkbox" name="type[]"  value="1" checked="">
							推文
						</div>
						<div class="radio">
							<input type="checkbox" name="type[]"  value="2">
							粉丝
						</div>
						<div class="radio">
							<input type="checkbox" name="type[]"  value="3">
							跟随者
						</div>
						<div class="radio">
							<input type="checkbox" name="type[]" value="4">
							粉丝和跟随者
						</div>
				    </div>
				</div>
				<div class="form-group">
				  	<label for="inputRemakes" class="col-sm-2 control-label">备注</label>
				    <div class="col-sm-10">
				    	<textarea name="remark" class="form-control" placeholder="备注"></textarea>
				    </div>
				</div>
				<div class="box-footer text-right">
					<button class="btn btn-primary" style="padding: 8px 23px">提交</button>
				</div>
			</form>
	    </div>
	</div>
</div>
<script>
	$(function () {
		$("button").click(function(event) {
			var task_name = $("input[name='task_name']").val(),
				search_name = $("input[name='search_name']").val(),
				remark = $("textarea").val()
				type = $("input[name='type[]']").val();

			event.preventDefault();
			if(task_name.trim() == '' || search_name.trim() == '' || remark.trim() == '') {
				alert("信息填写不完整！");
				return false;
			}

			var checkbox = $("input[type='checkbox']:checked");

			if(checkbox.length == 0) {
				alert("请选择抓取内容");
				return false;
			}
			var typeStr = "";
			checkbox.each(function(i, value) {
				typeStr += $(value).val();
			});
			
			$.post("{{ url_for('task_add_submit') }}", {task_name: task_name, search_name: search_name, remark: remark, type: typeStr},function(data){
				console.log(data);
				if(data.status == 1) {
					alert('添加成功');
					location.reload();
				}
				else {
					alert('添加失败');
				}
			});

			
		});
	})
</script>
{% endblock %}
