{% extends 'common/layout.html' %}

{% block title %} 用户关系查询 {% endblock %}
{% block body %}

<link rel="stylesheet" href="{{ url_for('static', filename='plugin/DataTables-1.10.8/css/jquery.dataTables.css')}}">

<div class="content-wrap">
	<div class="clearfix input-group">
		<input class="form-control"  type="text" placeholder="请输入人物名称" style="width:200px">
		<span class="input-group-btn fl">
            <button id="search-button" class="btn btn-primary" type="button">查询</button>
        </span>
	</div>
	
	<ul id="realtion-tab" class="nav nav-tabs" style="font-size:15px;"> 
	    <li class="active">
	        <a href="#follower" data-toggle="tab">他的粉丝</a>
	    </li>
	    <li>
	    	<a href="#friends" data-toggle="tab">他的朋友</a>
	    </li>
	</ul>
	<div id="tab-content" class="tab-content" style="margin-top: 20px;">
	    <div class="tab-pane fade" id="friends">
	       <div class="table-wrap">
   		        <table class="table table-border">
   	        		<thead>
   	        			<tr>
   	        				<th>screen_name</th>
   	        				<th>name</th>
   	        				<th>加入日期</th>
   	        				<th>简介</th>
   	        				<th>粉丝数</th>
   	        				<th>朋友数</th>
   	        				<th>推文数</th>
   	        				<th>语言</th>
   	        				<th>操作</th>
   	        			</tr>
   	        			<tbody>
   	        			</tbody>
   	        		</thead>
   	        	</table>
   	    	</div>
   			<div class="view-more hidden"><a>查看更多推文</a></div>
	    </div>
	    <div class="tab-pane fade active in" id="followers">
	    	<div class="table-wrap">
		        <table class="table table-border">
	        		<thead>
	        			<tr>
	        				<th>screen_name</th>
	        				<th>name</th>
	        				<th>加入日期</th>
	        				<th>简介</th>
	        				<th>粉丝数</th>
	        				<th>朋友数</th>
	        				<th>推文数</th>
	        				<th>语言</th>
	        				<th>操作</th>
	        			</tr>
	        			<tbody>
	        			</tbody>
	        		</thead>
	        	</table>
	    	</div>
			<div class="view-more hidden"><a>查看更多推文</a></div>
	    </div>
	</div>
</div>

<script type="text/javascript">
	$(function() {
		$("#search-button").click(function () {
			var val = $('input').val().trim();
			if(val === '') {
				alert('人物名称不能为空');
				return;
			}
			$("tbody").empty();
			getUserFriends(val);
			getUserFollowers(val)
		});

		// $(".view-more").click(function() {
		// 	if($(this).attr('data-cursor').trim() == '') {
		// 		return;
		// 	}
		// 	var val = $('input').val().trim();
		// 	if(val === '') {
		// 		alert('人物名称不能为空');
		// 		return;
		// 	}
		// 	getUserRelation(val, $(this).attr('data-cursor'));
		// })
	})

	function getUserFriends(screen_name, cursor) {
		if(screen_name === '') {
			return;
		}
		if(cursor == null) {
			cursor = -1
		}
		$.post("{{ url_for('get_user_friends') }}", {screen_name: screen_name, cursor: cursor}, function(data) {
			$.each(data, function(i, val) {
				dataToElement(val, 0);
			})
			// if(data.length < 28) {
			// 	$(".view-more").addClass('hidden');
			// }
			// else {
			// 	$(".view-more").attr('data-cursor', data[data.length - 1].id);
			// 	$(".view-more").removeClass('hidden');
			// }
		})
	}

	function getUserFollowers(screen_name, cursor) {
		if(screen_name === '') {
			return;
		}
		if(cursor == null) {
			cursor = -1
		}
		$.post("{{ url_for('get_user_followers') }}", {screen_name: screen_name, cursor: cursor}, function(data) {
			$.each(data, function(i, val) {
				dataToElement(val, 1);
			})
			// if(data.length < 28) {
			// 	$(".view-more").addClass('hidden');
			// }
			// else {
			// 	$(".view-more").attr('data-cursor', data[data.length - 1].id);
			// 	$(".view-more").removeClass('hidden');
			// }
		})
	}

	function dataToElement(data, tab) {
		var tr = $("<tr>");
		tr.append($('<td>').text(data['screen_name'])).append($('<td>').text(data['name'])).append($('<td>').text(data['created_at'])).append($('<td>').text(data['description'])).append($('<td>').text(data['followers_count'])).append($('<td>').text(data['friends_count'])).append($('<td>').text(data['status_count'])).append($('<td>').text(data['lang'])).append($('<a>').attr("href", "/user_profile/"+data['screen_name']));
		
		if(tab == 0) {
			tr.appendTo($('#friends tbody'));
		}
		else {
			tr.appendTo($('#followers tbody'));
		}
		
	}
</script>
{% endblock %}